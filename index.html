<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>HOST - Clapback Game</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1e272e; color: white; display: flex; height: 100vh; margin: 0; overflow: hidden; }
        .sit-panel { width: 35%; background: #2c3e50; padding: 40px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-shadow: 5px 0 15px rgba(0,0,0,0.3); z-index: 2; position: relative; border-right: 5px solid #f1c40f; }
        .card-sit { background: white; color: #c0392b; padding: 30px; border-radius: 15px; font-size: 1.6rem; font-weight: 800; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); width: 90%; min-height: 250px; display: flex; align-items: center; justify-content: center; border: 5px solid #c0392b; line-height: 1.4; position: relative; }
        .wild-card { background: #8e44ad; color: white; padding: 15px 20px; border-radius: 50px; margin-top: 30px; font-size: 1.3rem; font-weight: bold; border: 3px solid white; display: none; animation: pop 0.4s; box-shadow: 0 5px 15px rgba(0,0,0,0.4); }
        .resp-panel { width: 65%; background: #ecf0f1; padding: 30px; display: flex; flex-direction: column; }
        .resp-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; color: #7f8c8d; font-weight: bold; }
        .resp-grid { flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; align-content: start; padding-bottom: 20px; }
        .resp-card { padding: 20px; border-radius: 10px; color: white; font-size: 1rem; font-weight: 600; box-shadow: 0 3px 6px rgba(0,0,0,0.2); animation: slideUp 0.5s; position: relative; }
        .card-green { background: #27ae60; border-left: 10px solid #2ecc71; }
        .card-orange { background: #e67e22; border-left: 10px solid #f39c12; }
        .card-red   { background: #c0392b; border-left: 10px solid #e74c3c; }
        .badge { position: absolute; top: -10px; right: -10px; padding: 5px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .badge-green { background: #2ecc71; color: #006400; }
        .badge-orange { background: #f39c12; color: #8e44ad; }
        .badge-red { background: #e74c3c; color: white; }
        .controls { position: absolute; bottom: 30px; display: flex; gap: 10px; }
        button { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: transform 0.1s; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        button:active { transform: translateY(4px); box-shadow: none; }
        .btn-reset { background: #95a5a6; color: white; }
        .btn-wild { background: #8e44ad; color: white; }
        .btn-next { background: #f1c40f; color: #2c3e50; }
        @keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
        @keyframes pop { from { transform:scale(0); } to { transform:scale(1); } }
    </style>
</head>
<body>

    <div class="sit-panel">
        <h3 style="color:rgba(255,255,255,0.5); margin:0 0 20px 0; letter-spacing:2px;">SITUASI KLIEN</h3>
        <div class="card-sit" id="sitText">Tekan 'Next' untuk mula</div>
        <div class="wild-card" id="wildText">‚ö° WILD CARD!</div>
        <div class="controls">
            <button class="btn-reset" onclick="resetGame()">üóëÔ∏è Reset</button>
            <button class="btn-wild" onclick="showWild()">üü£ Wild</button>
            <button class="btn-next" onclick="nextSit()">Next ‚û°</button>
        </div>
    </div>

    <div class="resp-panel">
        <div class="resp-header">
            <span style="font-size:1.5rem; color:#2c3e50;">Respon Peserta</span>
            <span id="count" style="background:#bdc3c7; padding:5px 15px; border-radius:20px; color:white;">0 Respon</span>
        </div>
        <div class="resp-grid" id="grid"></div>
    </div>

    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbyLCwOpRhHsN1mcSuyNLmTw-G2mG_GagtRzCR7VXT1N-xuHHwbWolRGQ1GTzsbBaFuc/exec';

        // --- SENARAI SITUASI (GENERAL / UNIVERSAL) ---
        const situations = [
            "Awak rasa awak betul-betul boleh faham ke apa saya rasa?",
            "Saya rasa sesi ni macam tak bergerak ke mana-mana la.",
            "Awak ni muda sangat, makan garam pun belum cukup.",
            "Saya bayar awak, jadi awak kena la setuju dengan saya.",
            "Jangan la skema sangat, cakap la macam kawan biasa.",
            "Awak tak payah nak berlagak pandai sangat boleh tak?",
            "Saya rasa awak macam tak dengar pun apa saya cakap.",
            "Kalau awak kat tempat saya, awak pun takkan boleh handle.",
            "Kenapa awak diam je? Bagi la solusi cepat.",
            "Saya tak suka cara awak pandang saya tadi.",
            "Awak ni nampak macam tak konfiden je nak tolong saya.",
            "Boleh tak kita skip mukadimah ni? Buang masa la.",
            "Awak takkan faham sebab hidup awak nampak senang.",
            "Saya dah jumpa ramai kaunselor, semua hampeh.",
            "Awak jangan nak judge saya pulak lepas dengar cerita ni.",
            "Saya rasa kita tak click la.",
            "Awak kena janji dengan saya yang awak takkan bagitahu sesiapa.",
            "Saya tak perlu ubah diri saya, orang lain yang kena berubah.",
            "Awak cakap senang la, sebab bukan awak yang kena.",
            "Saya rasa nak berhenti datang sesi la lepas ni."
        ];

        // --- WILD CARDS ---
        const wilds = [
            "Klien tiba-tiba hempas fail/buku!",
            "Masa tinggal 2 minit je lagi!",
            "Klien ni VVIP / Anak Dato'",
            "Klien cakap kuat gila (Menjerit)",
            "Ayat tu 'deep' sangat sampai awak sendiri terasa.",
            "Klien pusing cerita: 'Eh saya tak cakap pun macam tu!'",
            "Supervisor masuk bilik secara tiba-tiba.",
            "Klien mula menangis teresak-esak.",
            "Klien ugut nak viral-kan awak.",
            "Klien diam seribu bahasa lepas cakap ayat tu."
        ];

        // --- DATABASE JAWAPAN (Untuk Warna) ---
        const dbGreen = [
            "Saya dengar keraguan awak tu, terima kasih sebab jujur dengan saya.",
            "Boleh kita 'pause' sekejap? Saya rasa ada benda penting di sebalik ayat awak tu.",
            "Saya perasan nada suara awak berubah bila cakap pasal ni.",
            "Nampak macam awak rasa tak selamat dalam sesi ni sekarang.",
            "Saya nak pastikan saya betul-betul faham maksud awak, boleh jelaskan lagi?",
            "Ayat awak tu bagi kesan pada saya, nampak macam awak tengah kecewa.",
            "Walaupun awak rasa begitu, saya masih kat sini nak cuba faham.",
            "Mari kita tengok apa sebenarnya yang buat awak rasa macam tu.",
            "Saya tak boleh janji atau setuju terus, tapi saya boleh dengar dulu.",
            "Saya hargai pandangan awak, tapi peranan saya kat sini berbeza sikit.",
            "Saya rasa ada jurang antara kita sekarang, jom kita baiki.",
            "Ayat tu berat, boleh kita bincang kenapa awak rasa perlu cakap macam tu?",
            "Saya tak nak lawan cakap awak, saya cuma nak faham perspektif awak.",
            "Jom kita fokus pada apa yang berlaku dalam bilik ni sekarang.",
            "Saya sedar awak mungkin rasa saya tak cukup bagus, dan itu okay untuk dibincangkan."
        ];

        const dbOrange = [
            "Saya dengar awak rasa kecewa/marah.",
            "Nampak gayanya benda ni sangat berat untuk awak.",
            "Terima kasih sebab bagitahu saya apa awak rasa.",
            "Saya faham, situasi ni memang susah.",
            "Boleh awak sambung lagi? Saya tengah dengar.",
            "Saya minta maaf kalau awak rasa macam tu.",
            "Perasaan awak tu valid.",
            "Ambil masa awak, tak perlu terburu-buru.",
            "Saya nampak awak tengah struggle sekarang.",
            "Kita cuba selesaikan sama-sama ya."
        ];

        // --- LOGIK ---
        let seenRows = 0;

        function nextSit() {
            const text = situations[Math.floor(Math.random() * situations.length)];
            document.getElementById('sitText').innerText = text;
            document.getElementById('wildText').style.display = 'none';
            
            // Auto Reset Visual
            document.getElementById('grid').innerHTML = '';
            document.getElementById('count').innerText = "0 Respon";
            seenRows = 0;

            // Auto Reset Database (PENTING)
            fetch(scriptUrl + '?action=clear', { mode: 'no-cors' }).catch(e => console.log(e));
        }

        function showWild() {
            const text = wilds[Math.floor(Math.random() * wilds.length)];
            const el = document.getElementById('wildText');
            el.innerText = "‚ö° " + text;
            el.style.display = 'block';
        }

        function resetGame() {
            if(!confirm("Padam semua manual?")) return;
            // Panggil fungsi sama macam Next untuk clear
            fetch(scriptUrl + '?action=clear', { mode: 'no-cors' }).then(() => {
                document.getElementById('grid').innerHTML = '';
                document.getElementById('count').innerText = "0 Respon";
                seenRows = 0;
            });
        }

        function fetchAnswers() {
            fetch(scriptUrl)
                .then(r => r.json())
                .then(data => {
                    document.getElementById('count').innerText = data.length + " Respon";
                    
                    // Logic: Kalau data tiba-tiba kosong (sebab baru tekan next), reset seenRows
                    if (data.length < seenRows) {
                        seenRows = 0;
                        document.getElementById('grid').innerHTML = '';
                    }

                    if (data.length > seenRows) {
                        for (let i = seenRows; i < data.length; i++) {
                            addCard(data[i]);
                        }
                        seenRows = data.length;
                    }
                })
                .catch(e => console.log("Polling..."));
        }

        function determineClass(text) {
            if (dbGreen.includes(text)) return { css: "card-green", label: "Terapeutik", badge: "badge-green" };
            if (dbOrange.includes(text)) return { css: "card-orange", label: "Empati", badge: "badge-orange" };
            return { css: "card-red", label: "Defensif", badge: "badge-red" };
        }

        function addCard(text) {
            const type = determineClass(text);
            const div = document.createElement('div');
            div.className = "resp-card " + type.css;
            div.innerHTML = text + "<div class='badge " + type.badge + "'>" + type.label + "</div>";
            const grid = document.getElementById('grid');
            grid.appendChild(div);
            grid.scrollTop = grid.scrollHeight;
        }

        setInterval(fetchAnswers, 2000);
    </script>
</body>
</html>
